{% extends "base.html" %}
{% load static %}

{% block title %}
{{ slug }}
{% endblock %}

{% block css_files %}
  <link rel="stylesheet" href="{% static "rating_menu/styles/others.css" %}">
  <link rel="stylesheet" href="{% static "rating_menu/styles/buttons.css" %}">
  <link href="{% static "rating_menu/styles/mobile.css" %}" rel="stylesheet" media="only screen and (max-width: 935px)">
  <script src="{% static 'rating_menu/scripts.js' %}" defer></script>
{% endblock %}

{% block content %}
<div class="sidebar">
  {% include "includes/header_buttons.html" %}
</div>

<main class="main-content">
  <div class="input-group mb-3 position-relative">
    <span class="input-group-text" id="search-icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001l3.85 3.85a1 1 0 0 0 1.415-1.415l-3.85-3.85zm-5.242 1.106a5.5 5.5 0 1 1 0-11 5.5 5.5 0 0 1 0 11z"/>
      </svg>
    </span>
    <input type="text" class="form-control" placeholder="Search..." aria-label="Search" aria-describedby="search-icon">
    <button type="button" class="btn btn-success js-show-form">Add new</button>
    <form method="post" id="suggestion-form" autocomplete="off">
      {% csrf_token %}
      <input type="hidden" name="suggestion" id="suggestion-input">
      <ul id="suggestions" class="list-group mt-2" style="display:none;">
        {% for movie in movies|slice:":6" %}
          <li class="list-group-item" data-title="{{ movie.title }}">{{ movie.title }}</li>
        {% endfor %}
      </ul>
    </form>
  </div>
    
  {% for movie in page_obj %}
<div class="media-content d-flex mb-4">

  <!-- Poster -->
  <div class="movie">
    <img src="{{ movie.poster_url }}"
         class="img-fluid" alt="{{ movie.title }}">
  </div>

  <!-- Info -->
  <div class="movie-info d-flex flex-column justify-content-between" style="flex:1;">

    <!-- Верхняя часть -->
    <div>
      <h2>{{ movie.title }}</h2>
      <p>{{ movie.description|truncatechars:400 }}</p>
      <p><strong>Add at: </strong>{{ movie.created_at }}</p>
      <p><strong>Release date: </strong>{{ movie.year }}</p>
      <p><strong>Genres: </strong>{{ movie.genre }}</p>
      </div>

            <div id="rating-and-delete" class=" d-flex justify-content-end">
        <div class="star-display d-flex justify-content-end gap-2 mt-4" data-rating="{{ movie.rating }}"></div>
        <form  method="POST" class="d-flex justify-content-end">
          {% csrf_token %}
          <input type="hidden" name="delete_movie_id" value="{{ movie.id }}">
          <button type="submit" id="delete_movie_item" class="btn btn-danger mb-0">Delete</button>
        </form>
      </div>
  </div>
</div>
{% endfor %}
  </main>

  <div id="modal-overlay" style="display:none;">
    <form method='post'>
      {% csrf_token %}
      <div id="modal-form" class="card shadow position-relative" style="min-width: 450px; max-width: 110vw;">
        <div class="card-body p-4">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <!-- Search bar (top left) -->
              <div class="input-group">
                
                <span class="input-group-text" id="search-icon-modal">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001l3.85 3.85a1 1 0 0 0 1.415-1.415l-3.85-3.85zm-5.242 1.106a5.5 5.5 0 1 1 0-11 5.5 5.5 0 0 1 0 11z"/>
                  </svg>
                </span>
                {% if error %}
                  <div class="alert alert-danger">{{ error }}</div>
                {% endif %}
                {{ form.title }}
                <span> {{ form.error }} </span>
                <ul id="suggestions_modal"  class="list-group mt-2"style="display:none;">
                  {%for suggestion in suggestions|slice:":5" %}
                    <li class="list-group-item" data-title="{{ suggestion.title }}">{{ suggestion.title }}</li>
                  {% endfor %}
                </ul>
              </div>

            <div class="movie position-relative"
             style="width: 160px; height: 220px; background: #eee; border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;"
             >
              <input type="hidden" id="index-input" name="index">
              <button id="prev-btn" 
              type="button" 
              class="btn btn-light arrow-btn" 
              style="position: absolute; top: 50%; left: 10px; transform: translateY(-50%);"
              data-direction="-1">
                &lt;
              </button>
              <button id="next-btn" 
              type="button" 
              class="btn btn-light arrow-btn" 
              style="position: absolute; top: 50%; right: 10px; transform: translateY(-50%);" 
              data-direction="1">
                &gt;
              </button>
              <img src=""
                   id="gallery-image"
                   class="img-fluid"
                   alt="">
            </div>



            <!-- Stars (top right) -->
            <div style="display: flex; flex-direction: column; align-items: center; flex: 1;">
              <input type="hidden" id="star-rating-input" name="rating">
              <div id="star-rating" class="ms-3" style="font-size: 2rem; cursor: pointer;"></div>
              <h2 id="gallery-title" class="mt-2 mb-0" style="text-align: center; width: 100%;"></h2>
            </div>
          </div>
          <div class="d-flex justify-content-end gap-2 mt-4">
            <button type="submit" class="btn btn-success">Save</button>
            <button type="button" class="js-hide-form btn btn-danger">Cancel</button>
          </div>
        </div>
      </div>
    </form>
  </div>
    <h1 color="white">{{movies|length}}</h1>
  <script>
  const movieTitles = {{ movie_titles|safe }};
  </script>
  
    <nav aria-label="Page navigation">
  <ul class="pagination justify-content-center mt-4">
    {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
      </li>
    {% else %}
      <li class="page-item disabled">
        <span class="page-link">Previous</span>
      </li>
    {% endif %}

    {% for num in page_obj.paginator.page_range %}
      {% if page_obj.number == num %}
        <li class="page-item active">
          <span class="page-link">{{ num }}</span>
        </li>
      {% else %}
        <li class="page-item">
          <a class="page-link" href="?page={{ num }}">{{ num }}</a>
        </li>
      {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
      </li>
    {% else %}
      <li class="page-item disabled">
        <span class="page-link">Next</span>
      </li>
    {% endif %}
  </ul>
</nav>
<h1 color="white">{{suggestions}}</h1>
{% endblock %}


{% comment %}       <table>
        <tr>
          <td>      <span class="input-group-text" id="search-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
          <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001l3.85 3.85a1 1 0 0 0 1.415-1.415l-3.85-3.85zm-5.242 1.106a5.5 5.5 0 1 1 0-11 5.5 5.5 0 0 1 0 11z"/>
        </svg>
      </span>
    </td>
    <td>
    </td>
        </tr>
              <input type="text" class="form-control" placeholder="Search..." aria-label="Search" aria-describedby="search-icon">
      <button type="button" class="btn btn-success js-show-form">Add new</button>

        <tr>
          <td>
                  <form method="post" id="suggestion-form" autocomplete="off">
        {% csrf_token %}
        <input type="hidden" name="suggestion" id="suggestion-input">
        <ul id="suggestions" class="list-group mt-2" style="display:none;">
            {% for movie in movies|slice:":6" %}
                <li class="list-group-item" data-title="{{ movie.title }}">{{ movie.title }}</li>
            {% endfor %}
        </ul>
    </form>
          </td>
        </tr>
      </table> {% endcomment %}